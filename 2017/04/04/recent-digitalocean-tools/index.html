<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="andrewsomething" />
    <meta name="copyright" content="andrewsomething" />
    <meta property="og:site_name" content="asb@ubuntu:~$" />
    <meta name="twitter:site" content="@astarrb" />
    <meta name="twitter:creator" content="@astarrb" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="A Few Recent DigitalOcean Tools" />
    <meta name="date" content="2017-04-04 00:00:00-04:00" />
    <meta property="og:type" content="article" />
    <meta property="og:published_time" content="2017-04-04 00:00:00-04:00" />
    <meta property="og:title" content="A Few Recent DigitalOcean Tools" />
    <meta property="og:url" content="//blog.andrewsomething.com/2017/04/04/recent-digitalocean-tools/" />
    <meta property="og:description" content="Obligatory comment about how it’s been quite awhile since the last time I’ve blogged… With that out of the way, I wanted to share a few things that I’ve done recently that might be useful for others. In particular, there are a couple DigitalOcean related tools that …" />
    <meta name="description" content="Obligatory comment about how it’s been quite awhile since the last time I’ve blogged… With that out of the way, I wanted to share a few things that I’ve done recently that might be useful for others. In particular, there are a couple DigitalOcean related tools that …" />

        <link rel="alternate"  href="//blog.andrewsomething.com/feeds/all.atom.xml" type="application/atom+xml" title="asb@ubuntu:~$ Full Atom Feed"/>

        <title>A Few Recent DigitalOcean Tools</title>

        <link rel="stylesheet" href="//blog.andrewsomething.com/theme/webassets-external/321aa2707cb805f734afc57be504f740_pure.css">
        <link rel="stylesheet" href="//blog.andrewsomething.com/theme/webassets-external/cc1740b9f1c1fc6821e2809601a2b48a_style.css">
        <link rel="stylesheet" href="//blog.andrewsomething.com/theme/webassets-external/88bba058d746a0d767bdee723a04508d_pygments.css">

        <script src="//blog.andrewsomething.com/theme/webassets-external/58768c687b2e46d96188b7f9e98447ee_jquery-1.10.2.js"></script>
</head>

<body>
<div class="pure-g-r" id="layout">
<div class="sidebar pure-u">
    <div class="cover-img" style="background-color: #272822">
        <div class="cover-body">
            <header class="header">
                <hgroup>
                    <a href="/"><img class="avatar" src="//www.gravatar.com/avatar/c5187279a8111c09cb5960e47fdc03a8" height="72" width="72"></a>
                    <h1 class="brand-main"><a href="/">asb@ubuntu:~$</a></h1>
                    <p class="tagline">An underused blog...</p>
                    <div class="pages-menu">
                        <p>
                        </p>
                    </div>
                    <p class="social-links">
                            <a target="_blank" class="social GitHub" href="https://github.com/andrewsomething"><img height="48" width="48" src="//blog.andrewsomething.com/images/social/github.svg" title="GitHub"></a>
                            <a target="_blank" class="social Launchpad" href="https://launchpad.net/~andrewsomething"><img height="48" width="48" src="//blog.andrewsomething.com/images/social/launchpad.svg" title="Launchpad"></a>
                            <a target="_blank" class="social Twitter" href="https://twitter.com/astarrb"><img height="48" width="48" src="//blog.andrewsomething.com/images/social/twitter.svg" title="Twitter"></a>
                            <a target="_blank" class="social RssFeed" href="//blog.andrewsomething.com/feeds/all.atom.xml"><img height="48" width="48" src="//blog.andrewsomething.com/images/social/rssfeed.svg" title="RssFeed"></a>
                    </p>
                </hgroup>
            </header>
        </div>
    </div>
</div>    <div class="pure-u-3-4">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>A Few Recent DigitalOcean&nbsp;Tools</h1>
                        <p class="post-meta">
                            meta = {'category': <a href="//blog.andrewsomething.com/category/digitalocean/">digitalocean</a>, 'date': Tue 04 April 2017}
                            <div class="meta-tags">
                                tags = [<a class="post-category" href="//blog.andrewsomething.com/tag/fabric/">Fabric</a><span class="comma">, </span><a class="post-category" href="//blog.andrewsomething.com/tag/digitalocean/">DigitalOcean</a><span class="comma">, </span><a class="post-category" href="//blog.andrewsomething.com/tag/github/">GitHub</a><span class="comma">, </span><a class="post-category" href="//blog.andrewsomething.com/tag/ansible/">Ansible</a><span class="comma">, </span>]
                            </div>
                        </p>
                </header>
            </section>
            <p>Obligatory comment about how it&#8217;s been quite awhile since the last time I&#8217;ve&nbsp;blogged&#8230;</p>
<p>With that out of the way, I wanted to share a few things that I&#8217;ve done recently that might be useful for others. In particular, there are a couple <a href="https://www.digitalocean.com">DigitalOcean</a> related tools that might come in&nbsp;handy.</p>
<h2>fabric-digitalocean</h2>
<p>As I&#8217;ve written before, <a href="http://www.fabfile.org/">Fabric</a> is a great tool for automating some basic systems administration tasks. Recently, I wrote <code>fabric-digitalocean</code> in order to make it easier to use Fabric with DigitalOcean Droplets. It provides an <code>@droplets</code> decorator for use in your Fabfiles. It can take a list of Droplet IDs, a tag, or a region as an argument. Then, using the DigitalOcean <span class="caps">API</span>, these arguments are expanded to provide Fabric with a list of&nbsp;hosts.</p>
<p>More and more, <a href="https://www.digitalocean.com/company/blog/droplet-tagging-organize-your-infrastructure/">tagging</a> is becoming an important way to interact with DigitalOcean resources. For example, <span class="caps">DO</span> Load Balancers use tags for service discovery, and the <a href="https://www.digitalocean.com/company/blog/introducing-monitoring/">newly released Monitoring</a> functionality allows you to create alert policies based on tags. If you&#8217;re already using tags across your fleet, the ability to run tasks on instances based on how they are tagged is extremely&nbsp;convenient.</p>
<p>As a quick example, this Fabfile could be used to run the <code>uptime</code> on all Droplets tagged&nbsp;&#8220;production&#8221;:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">from</span> <span class="nn">fabric_digitalocean.decorators</span> <span class="kn">import</span> <span class="n">droplets</span>

<span class="nd">@task</span>
<span class="nd">@droplets</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;production&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;uptime&#39;</span><span class="p">)</span>
</pre></div>


<p>It can be installed via <code>pip</code> with:</p>
<div class="highlight"><pre><span></span>pip install fabric-digitalocean
</pre></div>


<p>The source is <a href="https://github.com/andrewsomething/fabric-digitalocean">available on GitHub</a>. I&#8217;d love to hear any ideas you might have for other integration points between Fabric and the <span class="caps">DO</span> <span class="caps">API</span>.</p>
<h2>DigitalOcean monitoring agent Ansible&nbsp;role</h2>
<p>While Fabric obviously still has a place in my toolkit, <a href="https://www.ansible.com/">Ansible</a> has taken on a growing role in how I manage my infrastructure. It is flexible enough for both running one-off tasks and standing up services fully under configuration&nbsp;management.</p>
<p><a href="https://www.digitalocean.com/company/blog/improved-graphs/">In Janurary</a>, DigitalOcean released an <a href="https://github.com/digitalocean/do-agent">open-source monitoring agent</a>. It&#8217;s used to power both the graphs displaying Droplet metrics as well the new Monitoring and alerting features. You can optionally install the agent when creating new Droplets. Though if you have an existing fleet, it can be a bit tedious to install it on all of your currently running&nbsp;instances.</p>
<p>When I was backfilling the agent onto my existing Droplets, I wanted a single Ansible role that I could use regardless of the underlaying distribution. I was also eager to see what it takes to get something up on Ansible Galaxy, their hub for sharing and distributing roles. So I put together a role to install the agent on all supported distros and made it <a href="https://galaxy.ansible.com/andrewsomething/do-agent/">available there</a>.</p>
<p>You can install it&nbsp;with:</p>
<div class="highlight"><pre><span></span>ansible-galaxy install andrewsomething.do-agent
</pre></div>


<p>Once installed, an example playbook simply looks&nbsp;like:</p>
<div class="highlight"><pre><span></span>- hosts: all
  become: true
  roles:
     - andrewsomething.do-agent
</pre></div>


<p>The source is also <a href="https://github.com/andrewsomething/ansible-role-do-agent">available on GitHub</a>.</p>
            <div class="hr"></div>
            <a href="#" class="go-top">Go Top</a>
    <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_config = function () {
                this.page.url = 'https:////blog.andrewsomething.com/2017/04/04/recent-digitalocean-tools/';
                this.page.identifier = '2017/04/04/recent-digitalocean-tools/';
                this.page.title = 'A Few Recent DigitalOcean Tools';
            };
            (function() {
                var d = document, s = d.createElement('script');
                s.src = 'https://andrewsomething.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view <a href="//disqus.com/?ref_noscript">comments</a>.</noscript>
    </div>
<footer class="footer">
    <p>Powered by <a href="http://blog.getpelican.com/">Pelican</a> with a <a href="https://github.com/razius/razius.com/">modified theme</a> based on <a href="https://github.com/danclaudiupop/pure">Pure</a>. Social icons from <a href="https://simpleicons.org/">SimpleIcons.org</a>.        <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-50175676-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>